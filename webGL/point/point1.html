<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>point</title>

<!-- 顶点着色器 -->
<script id = "vs" type="x-shader/x-vertex">
  attribute vec4 a_Position;
  void main () {
    gl_Position = a_Position;
    gl_PointSize = 10.0;
  }
</script>

<!-- 片段着色器 -->
<script id = "fs"  type="x-shader/x-fragment">
  precision mediump float;
  uniform vec4 u_FragColor;
  void main() {
    gl_FragColor = u_FragColor;
  }
</script>
</head>
<body>
<p>点的数据从 js 中传入。封装着色器和程序的初始化代码</p>
<canvas id="canvas" width="600" height="600"></canvas>

<script>

window.onload = function(){

  var c = document.getElementById('canvas');
  var gl = c.getContext('webgl');

  // 初始化
  gl.clearColor( 0.0, 0.0, 0.0, 1.0 )
  gl.clear( gl.COLOR_BUFFER_BIT );

  // 获取元素
  var vs = document.getElementById('vs');
  var fs = document.getElementById('fs')

  // initShader
  var v_shader = initShader('vs');
  var f_shader = initShader('fs');

  // initProgram
  var program = initProgram( v_shader, f_shader );

  // 获取 attribute 变量的存储位置
  var a_Position = gl.getAttribLocation( program, 'a_Position' )
  // 将顶点位置传递给 attribute
  var position = new Float32Array( [0.0, 0.0, 0.0] )
  gl.vertexAttrib3fv( a_Position, position )

  var u_FragColor = gl.getUniformLocation( program, 'u_FragColor' )
  // 将颜色信息传递给 uniform
  var color = [1.0, 0.0, 0.0, 1.0]
  gl.uniform4fv( u_FragColor, color )

  // 绘制
  gl.drawArrays( gl.POINTS, 0, 1 );



  /*
    *  @param id 存在 html 模板中的 GLSL
    *  @ return 一个编译完成的着色器
   */
  function initShader(id){
    var shader;
    var el = document.getElementById(id);
    // 生成着色器
    switch( el.type ){
      // 顶点着色器
      case 'x-shader/x-vertex':
        shader = gl.createShader( gl.VERTEX_SHADER )
        break;

      case 'x-shader/x-fragment':
        shader = gl.createShader( gl.FRAGMENT_SHADER )
        break;

      default: 
        return;
    }
    // 传入 GLSL
    gl.shaderSource( shader, el.text );
    // 编译
    gl.compileShader( shader )
    // 检测
    if( gl.getShaderParameter( shader, gl.COMPILE_STATUS ) ){
      return shader;
    } else {
      alert( gl.getShaderInfoLog( shader ) )
    }
  }

  /*
   *  @param  shader
   *  @return program
   */
  function initProgram( vs, fs ) {

    var program = gl.createProgram();

    // 为程序绑定 shader
    gl.attachShader( program, vs )
    gl.attachShader( program, fs )

    // 连接模板
    gl.linkProgram( program );

    // 检查状态
    if ( gl.getProgramParameter( program, gl.LINK_STATUS ) ){

      // 使用 当前prgram
      gl.useProgram( program );
      return program;
    }else {
      alert('初始化程序错误');
    }
  }

}
</script>

</body>
</html>